using System.Windows.Forms;

namespace TicketApp
{
    public partial class Form1 : Form
    {
        private List<Task> taskList = new List<Task>(); // Lista przechowuj¹ca taski
        private int nextTaskId = 1; // Identyfikator kolejnego taska
        public Form1()
        {
            InitializeComponent();
        }

        private void flowLayoutPanel1_Paint(object sender, PaintEventArgs e)
        {

        }

        private void Form1_Load(object sender, EventArgs e)
        {

        }
        private string GenerateTaskId()
        {
            return nextTaskId.ToString("D4"); // Format liczby na cztery cyfry (np. 0001)
        }

        private List<Task> closedTasks = new List<Task>(); // Lista zamkniêtych tasków

        // Metoda do dodawania Taska do FlowLayoutPanel
        private void AddTaskToPanel(Task task)
        {
            // Tworzenie nowego Label jako reprezentacji taska
            Label taskLabel = new Label();
            taskLabel.Text = $"{task.Id}: {task.Title}";
            taskLabel.AutoSize = true;
            taskLabel.BorderStyle = BorderStyle.FixedSingle;
            taskLabel.Padding = new Padding(5);
            taskLabel.Margin = new Padding(5);


            // Dodaj zdarzenie klikniêcia do Label (np. aby wyœwietliæ szczegó³y)
            taskLabel.Click += (s, e) =>
            {
                // Tworzymy nowe okno dialogowe i ustawiamy szczegó³y zadania
                TaskDialog dialog = new TaskDialog();
                dialog.SetTaskDetails(task.Title, task.Description);
                var dialogResult = dialog.ShowDialog(); // Wyœwietlenie okna dialogowego
                                                        // Je¿eli u¿ytkownik zatwierdzi³ zmiany, aktualizujemy task
                if (dialogResult == DialogResult.OK)
                {
                    task.Title = dialog.TaskTitle; // Zaktualizuj tytu³
                    task.Description = dialog.TaskDescription; // Zaktualizuj opis

                    // Odœwie¿ tekst etykiety, aby wyœwietliæ zmienione dane
                    taskLabel.Text = $"{task.Id}: {task.Title}";
                }
                else if (dialogResult == DialogResult.Ignore)
                {
                    // Zamkniêcie taska: przenosimy go do listy zamkniêtych
                    closedTasks.Add(task); // Dodajemy do listy zamkniêtych
                    flowLayoutPanel1.Controls.Remove(taskLabel);
                }
            };

            // Dodanie etykiety do FlowLayoutPanel
            flowLayoutPanel1.Controls.Add(taskLabel);
        }
        private void AddTaskButton_Click(object sender, EventArgs e)
        {
            // Utwórz nowe okno dialogowe
            TaskDialog taskDialog = new TaskDialog();
            var dialogResult = taskDialog.ShowDialog();

            // Jeœli u¿ytkownik klikn¹³ OK, dodaj task
            if (dialogResult == DialogResult.OK)
            {
                string taskId = GenerateTaskId(); // Wygeneruj ID
                string title = taskDialog.TaskTitle; // Pobierz tytu³ od u¿ytkownika
                string description = taskDialog.TaskDescription; // Pobierz opis od u¿ytkownika

                // Stwórz nowy task
                Task newTask = new Task(int.Parse(taskId), title, description);
                taskList.Add(newTask); // Dodaj do listy
                nextTaskId++; // Zwiêksz Id kolejnego taska

                // Wyœwietl task w FlowLayoutPanel
                AddTaskToPanel(newTask);
            }
        }

    }
}
